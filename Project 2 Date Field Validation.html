<!DOCTYPE html>

<!--

DESCRIPTION/NOTES:-
--------------------------------------------------------------------------------------------

A simple date validation tool, for any basic string input element(s), that validates dynamically as the end-user types out a date. It is designed to be as compatible (both backwards & cross-browser) as possible, while covering all user inputs that could be attempted when typing a date (both valid or invalid).

============================================================================================

Remote Name: https://github.com/tberey/date-validation
Branch Name: https://github.com/tberey/test/tree/~

============================================================================================

1) Add drop down for US/other formats input functionality, to output a UK date plus the others.


2) Make it so that the button is the only way in and out of field.


3) Add IE < 11 Support!


!!!!Note: USED SELENIUM FOR CROSS-USER AGENT TESTING!!!!
!!!!Additional Comments!!!!

-->

<html>
	<head>
		<!-- Set a Responsively scaled viewport, and assign some Metadata. -->
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1">
			<title>Project 2: Date Field Validation</title>
		<meta name="author" content="Tom B">
		<meta name="description" content="Date Field Validation, JavaScript">
		<!-- Set in-page CSS Attributes/Properties. -->
		<style type="text/css">
			body {
				display: flex;
			}
			
			button {
				pointer-events: auto;
				background-color: rgb(23, 124, 207);
 				border: none;
				border-radius:50%;
 				color: white;
  				padding: 15px 32px;
  				text-align: center;
  				text-decoration: none;
  				display: inline-block;
 				font-size: 10px;
 				margin: 4px 2px;
				cursor: pointer;
			}
			
			input[type=text] {
				width: 30%;
				padding: 5px;
				margin: 20px;
				box-sizing: border-box;
				border: none;
				border-bottom: 3px solid rgb(161, 1, 1);
				color: white;
				background-color: rgb(13, 112, 99);
				
			}
			
			input[type=text]:focus {
				width: 50%;
				color: black;
				border: 3px solid rgb(32, 221, 32);
				background-color: #89f885;
				
			}
			
			input::placeholder {
				color: rgb(161, 1, 1);
			}
			
			#form {
				flex: 1;
				width: 40%;
				border: 3px solid rgb(19, 0, 128);
				overflow: visible;
				background-color: rgb(13, 112, 99);
				float: left;
				pointer-events: none;
			}
			
			#output {
				flex: 1;
				width: 40%;
				border: 3px solid rgb(4, 77, 8);
				background-color: rgb(91, 100, 12);
				float: left;
				margin-left: 3px;
			}
		</style>
	</head>
	
	<body>
		<!-- Left/Blue input side of document area. Where the targeted element nests. -->
		<div id="form">
			<button onclick="!buttonBool ? inputField.focus() : inputField.blur();">Change Date</button>
			<input name="DateInput" type="text" placeholder="dd/mm/yyyy" onfocus="this.select();">
			<p>Please enter a date in a UK format.</p>
			<p>Anything similar to "d/m/y".</p>
		</div>
		<!-- Right/Green side of document area, where the output is. -->
		<div id="output">
			<p><b>Output:-</b></p>
			</br>
			<p id="d1"><i>Enter a date in the field on the left...</i></p>
			<hr>
		</div>
		<!-- Begin Scripting. -->
		<script type="text/javascript">
			// Global Declaration Space.
			let inputField = document.getElementsByName('DateInput')[0], outputParentEl = document.getElementById('output'), buttonBool;
			
			// Calls the 'initialised' function, once the document is ready/fully-loaded.
			if (document.addEventListener) document.addEventListener("DOMContentLoaded", initialised, false);
			else if (document.attachEvent) document.attachEvent("onreadystatechange", initialised);
			else window.onload = initialised;
			
			// Set/Unset Event Listeners within this function (some nested). The active listeners will call relevant the function, based on action/event.
			function initialised() {
				inputField.addEventListener('focus', () => {
					
					inputField.addEventListener('keydown', () => {
						keyDownEv(event);
					});
					
					inputField.addEventListener('keyup', () => {
						checkInputtedChr(inputField);
						outputBox();
					});
				});
				
				inputField.addEventListener('blur', () => {
					outputBox(true);
					
					inputField.removeEventListener('keydown', () => {
						keyDownEv(event);
					});
					
					inputField.removeEventListener('keyup', () => {
						checkInputtedChr(inputField);
						outputBox();
					});
				});
			}
			
			function keyDownEv(event) {
				if ([17, 36, 37, 38, 40].indexOf(event.keyCode) > -1) {
					event.preventDefault();
				} else if (event.repeat) {
					inputField.value = inputField.value.substring(0, inputField.value.length - 1);
				} else if (outputParentEl.childNodes.length > 11) {
					['USDate','ISODate','fullDate','UADate'].forEach((val) => {
						outputParentEl.removeChild(document.getElementById(val));
					});
				}
			}
			
			function checkInputtedChr() {
				let fieldVal = inputField.value;
				let n = fieldVal.length
				let chr = fieldVal[n-1], prevChr = fieldVal[n-2], thirdReversedChr = fieldVal[n-3];
				let int = parseInt(chr);
				
				function delChr(a) {
					inputField.value = fieldVal.substring(0, n-1);
					
					if (a) {
						let seperator = fieldVal[fieldVal.search(/[-/.]/)] || '/';
						inputField.value = inputField.value + seperator;
					}
				}
				
				switch(true) {
					case (n < 3):
						if ((n == 1 && isNaN(int)) ||
						(n == 2 && ((prevChr == 3 && int > 1) ||
						(prevChr == 0 && (isNaN(int) || int == 0))))) {
							delChr();
						} else if (n == 2 && ['/','-','.'].indexOf(chr) == -1 && (isNaN(int) || prevChr > 3)) {
							delChr(1);
						}
						break;
					
					case (n == 3):
						if (isNaN(prevChr) && isNaN(int)) {
							delChr();
						} else if (!isNaN(prevChr) && ['/','-','.'].indexOf(chr) == -1) {
							delChr(1);
						}
						break;
						
					case (n == 4):
						if ((isNaN(prevChr) && isNaN(int)) || (prevChr == 0 && (isNaN(int) || int == 0))) {
							delChr();
						}else if ((prevChr == 1 && ['/','-','.'].indexOf(chr) == -1 && (int > 2 || isNaN(int))) ||
						(prevChr > 1 && ['/','-','.'].indexOf(chr) == -1)) {
							delChr(1);
						}
						break;
						
					case (n == 5):
						if ((isNaN(prevChr) && isNaN(int)) ||
						(prevChr == 1 && (int > 2 ||(!isNaN(thirdReversedChr) && !isNaN(int)))) ||
						(prevChr == 0 && ((isNaN(thirdReversedChr) && (isNaN(int) || int == 0)) || (!isNaN(thirdReversedChr) && !isNaN(int))))) {
							delChr();
						} else if ((prevChr < 2 && ['/','-','.'].indexOf(chr) == -1 && isNaN(int)) ||
						(prevChr > 1 && ['/','-','.'].indexOf(chr) == -1)) {
							delChr(1);
						}
						break;
					
					case (n == 6):
						if ((isNaN(prevChr) && isNaN(int)) ||
						(isNaN(thirdReversedChr) && isNaN(int))) {
							delChr();
						} else if (!isNaN(prevChr) &&
						((isNaN(thirdReversedChr) && isNaN(int)) || (!isNaN(thirdReversedChr) && ['/','-','.'].indexOf(chr) == -1))) {
							delChr(1);
						}
						break;
					
					case (n < 11):
						if ((n < 9 && isNaN(int)) ||
						(n == 9 && (isNaN(int) || fieldVal.lastIndexOf("/") == 3)) ||
						(n == 10 && (isNaN(int) || fieldVal.lastIndexOf("/") == 4))) {
							delChr();
						}
						break;
					default:
						delChr();
				}
				
				// Conditional that deals with any invalid but conflicting scenario's that, as a result, can't be include in the above switch conditional. (Due to them being more specific problems, to be targeted).
				if (inputField.value.length > 1 &&
				inputField.value[n-1] !== undefined &&
				inputField.value[n-1].search(/[-/.]/) > -1 &&
				fieldVal.substring(0, n-1).search(/[-/.]/) > -1) {
					delChr(1);
				} else if (inputField.value.search(/([A-Z])/i) > -1 || inputField.value.search(/[\D]{2}/g) > -1) {
					inputField.value = '';
				}
			}
			
			function outputBox(blur=false) {
				if (inputField.value.length == 0) {
					inputField.value = '';
					document.getElementById('d1').innerHTML = '<i>Enter a date in the field on the left...</i>';
				} else if (blur &&
				(inputField.value.length < 6 || isNaN(inputField.value[inputField.value.length - 2]) || isNaN(inputField.value[inputField.value.length - 4]))) {
					inputField.value = '';
					document.getElementById('d1').innerHTML = '<i>Invalid Date Entered!</i>';
				} else {
					document.getElementById('d1').innerHTML = `Entered Date: <b>"${inputField.value}"</b>`;
					
					if (blur && inputField.value.split(/[-/.]/).length == 3 && outputParentEl.childNodes.length < 10) {
						let dateConstistuentsArray = inputField.value.split(/[-/.]/);
						for (let i = 0; i < 3; i++) {
							switch (dateConstistuentsArray[i].length) {
								case 1:
									dateConstistuentsArray[i] = '0' + dateConstistuentsArray[i];
									break;
							}
						}
						
						let dd = dateConstistuentsArray[0], mm = dateConstistuentsArray[1], yyyy = dateConstistuentsArray[2];
						let userInputDate = (new Date(yyyy, (mm-1), dd).toUTCString()).split(' 00:00:00 ');
						let usDate = document.createElement('P'),
						isoDate = document.createElement('P'), fullDate = document.createElement('P'), uaDate = document.createElement('P');
						
						usDate.setAttribute("id", "USDate");
						usDate.innerHTML = `US Date: <b>${mm}-${dd}-${yyyy}</b>`;
						
						isoDate.setAttribute("id", "ISODate");
						isoDate.innerHTML = `ISO (International Standard) Date: <b>${yyyy}-${mm}-${dd}</b>`;
						
						fullDate.setAttribute("id", "fullDate");
						fullDate.innerHTML = `Full Date Entered:</br><b>${userInputDate[0]} ${userInputDate[1]}</b>`;
						
						uaDate.setAttribute("id", "UADate");
						uaDate.innerHTML = `Your Local Time (<i><u>UTC ${-(Math.floor(new Date().getTimezoneOffset()/60)) || '+/-0'} hours</u></i>):</br><b>${new Date()}</b>`;
						
						[usDate,isoDate,fullDate,uaDate].forEach((val) => {
							outputParentEl.appendChild(val);
						});
					}
				}
			}
		</script>
		<!-- End of Scripting. -->
	</body>
</html>